var M=Object.defineProperty;var o=(n,a)=>M(n,"name",{value:a,configurable:!0});var D=o(function(n){return new Promise(function(a){setTimeout(a,n)})},"waitFor"),b;(function(n){n.DEV="DEV",n.UAT="UAT",n.PRD="PRD"})(b||(b={}));var S;(function(n){n.GITHUB="GitHub",n.GITLAB="GitLab",n.BITBUCKET="Bitbucket",n.LOCALHOST="localhost",n.UNKNOWN="unknown"})(S||(S={}));var U=globalThis&&globalThis.__awaiter||function(n,a,t,u){function i(e){return e instanceof t?e:new t(function(s){s(e)})}return o(i,"adopt"),new(t||(t=Promise))(function(e,s){function g(c){try{r(u.next(c))}catch(d){s(d)}}o(g,"fulfilled");function v(c){try{r(u.throw(c))}catch(d){s(d)}}o(v,"rejected");function r(c){c.done?e(c.value):i(c.value).then(g,v)}o(r,"step"),r((u=u.apply(n,a||[])).next())})},_=globalThis&&globalThis.__generator||function(n,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},u,i,e,s;return s={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function g(r){return function(c){return v([r,c])}}function v(r){if(u)throw new TypeError("Generator is already executing.");for(;t;)try{if(u=1,i&&(e=r[0]&2?i.return:r[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,r[1])).done)return e;switch(i=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,i=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(n,t)}catch(c){r=[6,c],i=0}finally{u=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},y="rmg-unknown",T="unknown",L=b.PRD,C=S.UNKNOWN,I=o(function(){return U(void 0,void 0,void 0,function(){var n,a,t,u;return _(this,function(i){switch(i.label){case 0:return n=window.location.pathname.split("/")[1],a=n?"/".concat(n,"/info.json"):"/info.json",[4,fetch(a)];case 1:return t=i.sent(),t.ok?[4,t.json()]:[3,3];case 2:u=i.sent(),y=u.component,T=u.version,L=u.environment,C=u.instance,i.label=3;case 3:return[2]}})})},"fetchInfoJson"),R=o(function(){return U(void 0,void 0,void 0,function(){return _(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),console.log("[rmg-runtime] Loading config..."),[4,Promise.race([I(),D(10*1e3)])];case 1:return n.sent(),console.log("[rmg-runtime] Config loaded!"),[3,3];case 2:return n.sent(),console.error("[rmg-runtime] Failed to load config"),[3,3];case 3:return[2]}})})},"waitForSettled"),x=o(function(){return y},"getComponent"),k=o(function(){return T},"getVersion"),F=o(function(){return L},"getEnvironment"),O=o(function(){return C},"getInstance");const l={waitForSettled:R,getComponent:x,getVersion:k,getEnvironment:F,getInstance:O};window.dataLayer=window.dataLayer||[];var j=o(function(){var n=document.createElement("script");n.async=!0,n.src="https://www.googletagmanager.com/gtag/js?id=G-2HP8Y4MRRQ",document.head.append(n)},"installGtag");function A(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(l.getEnvironment()!==b.DEV)return window.dataLayer.push(arguments);console.log("[rmg-runtime] Not going to send event in DEV environment",n)}o(A,"gtag");var V=o(function(n,a){A("event",n,a)},"customEvent"),H=o(function(){j(),A("js",new Date),A("config","G-2HP8Y4MRRQ",{appName:l.getComponent(),version:l.getVersion(),environment:l.getEnvironment(),instance:l.getInstance()})},"initLogger");l.waitForSettled().then(function(){H()});const W={customEvent:V};var B="rmg-runtime-channel",p={},h;try{h=new BroadcastChannel(B),h.onmessage=function(n){var a,t=n.data,u=t.event,i=t.data,e=t.frameId;(a=p[u])===null||a===void 0||a.forEach(function(s){return s(i,e)})}}catch(n){console.warn("[rmg-runtime] Failed to initiate broadcast channel. Some features may be unavailable.",n)}var K=o(function(n,a){var t;h==null||h.postMessage({event:n,data:a,frameId:(t=window.frameElement)===null||t===void 0?void 0:t.id})},"postEvent"),Y=o(function(n,a){var t;n in p?(t=p[n])===null||t===void 0||t.push(a):p[n]=[a]},"onMessage");const w={postEvent:K,onMessage:Y};var f;(function(n){n.SET_LANGUAGE="SET_LANGUAGE",n.OPEN_APP="OPEN_APP",n.UPDATE_URL="UPDATE_URL"})(f||(f={}));var N=o(function(){return!window.frameElement},"isStandaloneWindow"),$=o(function(){if(!N()){var n=document.createElement("style");n.textContent=".rmg-window__header{display: none !important;}",document.head.append(n)}},"injectCss"),z=o(function(n){w.postEvent(f.OPEN_APP,n)},"openApp"),Q=o(function(n){w.postEvent(f.UPDATE_URL,n)},"updateUrl"),J=o(function(n){w.onMessage(f.OPEN_APP,n)},"onAppOpen"),q=o(function(n){w.onMessage(f.UPDATE_URL,n)},"onUrlUpdate");const m={isStandaloneWindow:N,injectCss:$,openApp:z,onAppOpen:J,updateUrl:Q,onUrlUpdate:q};var G="rmg-runtime__language",P=["en","zh-Hans","zh-Hant"],X=o(function(n){P.includes(n)&&(w.postEvent(f.SET_LANGUAGE,n),window.localStorage.setItem(G,n))},"setLanguage"),Z=o(function(){var n=window.localStorage.getItem(G);return n&&P.includes(n)?n:"en"},"getLanguage"),nn=o(function(n){w.onMessage(f.SET_LANGUAGE,n)},"onLanguageChange");const E={setLanguage:X,getLanguage:Z,onLanguageChange:nn};var en=new Date().getTime();function tn(){var n=l.getComponent(),a=window.localStorage.getItem(n+"__startTime");return a===null?new Date().getTime()-en:new Date().getTime()-Number(a)}o(tn,"getMsSinceStartUp");const rn={getMsSinceStartUp:tn};var an=o(function(){var n=l.getComponent();if(n==="rmg-unknown"){console.log("[rmg-runtime] Unable to clear storage for unknown app");return}n==="railmapgen.github.io"&&(n="rmg-home");for(var a=0;a<window.localStorage.length;){var t=window.localStorage.key(a);t!=null&&t.startsWith(n+"__")?(window.localStorage.removeItem(t),console.log("[rmg-runtime] Removed item ".concat(t))):a++}},"clearStorageForCurrentApp");const on={clearStorageForCurrentApp:an};var un=globalThis&&globalThis.__awaiter||function(n,a,t,u){function i(e){return e instanceof t?e:new t(function(s){s(e)})}return o(i,"adopt"),new(t||(t=Promise))(function(e,s){function g(c){try{r(u.next(c))}catch(d){s(d)}}o(g,"fulfilled");function v(c){try{r(u.throw(c))}catch(d){s(d)}}o(v,"rejected");function r(c){c.done?e(c.value):i(c.value).then(g,v)}o(r,"step"),r((u=u.apply(n,a||[])).next())})},cn=globalThis&&globalThis.__generator||function(n,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},u,i,e,s;return s={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function g(r){return function(c){return v([r,c])}}function v(r){if(u)throw new TypeError("Generator is already executing.");for(;t;)try{if(u=1,i&&(e=r[0]&2?i.return:r[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,r[1])).done)return e;switch(i=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,i=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(n,t)}catch(c){r=[6,c],i=0}finally{u=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},sn={ready:function(){return un(void 0,void 0,void 0,function(){return cn(this,function(n){switch(n.label){case 0:return[4,Promise.all([l.waitForSettled()])];case 1:return n.sent(),[2]}})})},getAppName:l.getComponent,getAppVersion:l.getVersion,getEnv:l.getEnvironment,getInstance:l.getInstance,event:W.customEvent,isStandaloneWindow:m.isStandaloneWindow,injectCss:m.injectCss,openApp:m.openApp,onAppOpen:m.onAppOpen,updateUrl:m.updateUrl,onUrlUpdate:m.onUrlUpdate,setLanguage:E.setLanguage,getLanguage:E.getLanguage,onLanguageChange:E.onLanguageChange,clearStorageForCurrentApp:on.clearStorageForCurrentApp,getMsSinceStartUp:rn.getMsSinceStartUp};window.rmgRuntime=sn;export{b as R,sn as r};
//# sourceMappingURL=index.20564a1c.js.map
